---
layout: post
title: "node.js"
description: ""
category: 
tags: []
---
{% include JB/setup %}

galjghalsdh

2. 关闭socket池

Node.js的http模块会自动使用socket池，缺省是每台主机限制为5个socket。虽然这种socket复用方式可能对控制资源增长的速度有利，但如果你需要处理很多同时需要从同一台主机获取数据的并发请求，这个socket池会成为严重的性能瓶颈。在这种情况下，好的办法是增大maxSockets参数或者干脆把socket池disable掉。

 

3. 不要用Node.js处理静态资源

对于静态资源，例如CSS和图像，使用标准的web服务器而不是Node.js来处理。例如，LInkedIn mobile使用nginx。我们还利用内容分发网络（CDN），它能把静态资源复制到分布在全世界的很多服务器上。这样做有两大益处：①减少了Node.js服务器的负载，②CDN能让静态内容从离用户比较近的服务器上传输过去，这样减少了延迟。

 

4. 在客户端渲染页面

让我们快速比较一下服务器端渲染和客户端渲染页面。如果我们让Node.js在服务器端渲染，我们会对所有请求发回一个类似于本文的HTML页面。

请注意，在这个页面上，除了用户名之外，所有内容都是静态的：也就是说，对于每个用户和每次刷新都是完全相同的。所以更有效率的方法是让Node.js只以JSON格式返回页面所需的动态数据。

页面的其他部分，也就是所有的静态HTML标记，可以放到一个JavaScript模板里（例如一个underscore.js模板）。

性能的受益是这么来的：根据秘籍3，静态JavaScript模板可以从你的web服务器（例如nginx）或者CDN获取。而且，JavaScript模板可以缓存在客户端或保存在本地存储，这样初始加载页面之后，唯一需要传给客户端的就是动态JSON数据，这是最高效率的做法。该方法极大地减少了Node.js服务器上占用的CPU, IO和负载。